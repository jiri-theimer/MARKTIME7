@model BO.p28Contact

@inject BL.Factory _f

@{


    if (Model == null)
    {
        return;
    }


    bool _bolRowHover = UI.Code.basUI.DetectIfCanRowHover(_f, Context, _f.CurrentUser.j04IsModule_p28);

    IEnumerable<BO.RoleAssignedToRecord> _lisRoles = _f.x67EntityRoleBL.GetRolesAssignedToRecord(Model.pid, "p28");
    BO.b02WorkflowStatus _recB02 = null;
    if (Model.b02ID > 0)
    {
        _recB02 = _f.b02WorkflowStatusBL.Load(Model.b02ID);
    }

    //int _intB05Count = _f.WorkflowBL.GetB05CommentsCount("p28", Model.pid);

    IEnumerable<BO.p24ContactGroup> _lisP24 = _f.p24ContactGroupBL.GetList(new BO.myQueryP24() { p28id = Model.pid });

}

@addTagHelper *, UI



<table class="table table-hover">
    @if (_bolRowHover)
    {
        <tr>
            <td colspan="2" class="@(Model.isclosed ? "tdarchiv": "tdval")" onmouseover="_handle_mywrk_mouseover(this)" onmouseout="_handle_mywrk_mouseout(this)">
                <span class="material-icons-outlined">contacts</span>
                @Model.p29Name
                <sup title="Kód">@(Model.p28Code)</sup>
                @if (Model.isclosed)
                {
                    <span title="Přesunuto do archivu" class="material-icons-outlined" style="color:red;">delete_forever</span>
                }
                <mywrkbutton prefix="p28" showcopyurl="true" pid="@Model.pid" b02id="@Model.b02ID" langindex="@_f.CurrentUser.j02LangIndex"></mywrkbutton>


            </td>
        </tr>
        <tr>
            <td class="tdlab">
                @_f.tra("Název"):
            </td>
            <td class="tdval">
                @Model.p28Name
            </td>
        </tr>
    }
    else
    {
        <tr>
            <td class="tdlab">
                @(Model.p29Name):
            </td>
            <td class="tdval">
                @Model.p28Name
            </td>
        </tr>
    }
    
    
    @if (_recB02 != null)
    {
        <tr>
            <td class="tdlab">
                @_f.tra("Aktuální stav"):
            </td>
            <td class="tdval">
                @if (_bolRowHover)
                {
                    <myval value="@_recB02.b02Name" hoverurl="/b02/Info?prefix=p28&pid=@Model.pid" valueafter="@(UI.Code.basUI.HtmlColorStrip(_recB02.b02Color))"></myval>
                }
                else
                {
                    @_recB02.b02Name
                }


            </td>
        </tr>
    }
    @if (Model.p28RegID != null)
    {
        <tr>
            <td class="tdlab">
                @_f.tra("IČO"):
            </td>
            <td class="rowvalhover tdval">
                @Model.p28RegID

                @if (Model.p28CountryCode == "SK")
                {
                    <a class="valhover_tooltip" href="javascript:_rejstrik_obchodny_register('hidICO')">obchodný register</a>
                }
                else
                {
                    <a class="valhover_tooltip" href="javascript: _rejstrik_justice('hidICO')">justice</a>
                    <a class="valhover_tooltip" href="javascript: _rejstrik_aresinfo('hidICO')">ares</a>
                    <a class="valhover_tooltip" href="javascript: _rejstrik_insolvence('hidICO')">insolvence</a>
                }

                <input type="hidden" id="hidICO" value="@Model.p28RegID" />
            </td>
        </tr>

    }

    @if (Model.p28VatID != null)
    {
        <tr>
            <td class="tdlab">
                @_f.tra("DIČ"):
            </td>
            <td class="rowvalhover tdval">
                @Model.p28VatID
                @if (Model.p28CountryCode == "CZ")
                {
                    <a class="valhover_tooltip" target="_blank" href="https://plus.marktime.net/Adis/Index?dic=@(Model.p28VatID)">Ověření plátce DPH</a>
                }
            </td>

        </tr>

    }

    @if (Model.p28City1 != null || Model.p28Street1 != null)
    {
        <tr title="Adresa #1">
            <td class="tdlab">
                <span class="material-icons-outlined">home</span>
            </td>
            <td class="rowvalhover tdval">

                @Html.Raw(BO.Code.Bas.Text2Html(Model.GetFullAddress(1)))
                <a class="valhover_tooltip" target='_blank' href="https://mapy.cz/zakladni?q=@(Model.p28City1+"+"+Model.p28Street1)">mapy</a>
                <a class="valhover_tooltip" target='_blank' href="https://www.google.com/maps/place/@(Model.p28City1+"+"+Model.p28Street1)">google</a>
            </td>
        </tr>

    }
    @if (Model.p28City2 != null || Model.p28Street2 != null)
    {
        <tr title="Adresa #2">
            <td class="tdlab">
                <span class="material-icons-outlined" style="color:orange;">home</span>
            </td>
            <td class="rowvalhover tdval">
                @Html.Raw(BO.Code.Bas.Text2Html(Model.GetFullAddress(2)))
                <a class="valhover_tooltip" target='_blank' href="https://mapy.cz/zakladni?q=@(Model.p28City1+"+"+Model.p28Street2)">mapy</a>
                <a class="valhover_tooltip" target='_blank' href="https://www.google.com/maps/place/@(Model.p28City1+"+"+Model.p28Street2)">google</a>
            </td>
        </tr>

    }


    @if (Model.p28ICDPH_SK != null)
    {
        <tr>
            <td class="tdlab">
                IČ DPH:
            </td>
            <td class="tdval">
                Model.p28ICDPH_SK
            </td>
        </tr>

    }

    @foreach (var c in _lisRoles)
    {
        <tr>
            <td class="tdlab">
                @(c.x67Name):
            </td>
            <td class="tdval">
                @c.Receivers

            </td>

        </tr>
    }
    
    @if (_lisP24.Count() > 0)
    {
        <tr>
            <td class="tdlab">
                @(_f.tra("Zařazení do skupin")):
            </td>
            <td class="tdval">
                @foreach (var c in _lisP24)
                {
                    <div>@c.p24Name</div>
                }
            </td>
        </tr>
    }

    @if (Model.p28JobTitle != null)
    {
        <tr>
            <td class="tdlab">
                @(_f.tra("Vizitka")):
            </td>
            <td class="tdval">
                @Model.p28JobTitle
            </td>
        </tr>

    }

    @if (Model.p28BankAccount != null)
    {
        <tr>
            <td class="tdlab">
                @(_f.tra("Bankovní účet")):
            </td>
            <td class="rowvalhover tdval">
                @(Model.p28BankAccount + "/" + Model.p28BankCode)
            </td>
        </tr>

    }


</table>



