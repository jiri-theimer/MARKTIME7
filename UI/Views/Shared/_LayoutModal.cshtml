@model BaseViewModel
@inject BL.Factory _f

@{
    @addTagHelper *, UI
}


<!DOCTYPE html>

<html lang="cs">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@(Model.PageTitle) | MARKTIME</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link href="~/lib/datepicker/bootstrap-datepicker.min.css" rel="stylesheet" type="text/css" />
    <link href="~/lib/qtip/jquery.qtip.css" rel="stylesheet" type="text/css" />
    <link href="~/lib/autocomplete/jquery.autocomplete.css" rel="stylesheet" type="text/css" />

    <style type="text/css">
        :root {
            --pozadi: @_f.CurrentUser.j02SkinBackColor;
            --popredi: @_f.CurrentUser.j02SkinForeColor;
            --oznaceno: @_f.CurrentUser.j02SkinSelColor;
        }
    </style>
    <link rel="stylesheet" href="~/css/@_f.CurrentUser.getFontSizeCss()" />

    <link rel="stylesheet" href="~/css/site.css" />
    <link rel="stylesheet" href="~/css/contextmenu.css" />
    @if (_f.CurrentUser.x01CustomCssFile != null)
    {
        <link rel="stylesheet" href="@_f.CurrentUser.x01CustomCssFile" />
    }
    <link rel="stylesheet" href="~/css/thegrid.css" />

    @if (IsSectionDefined("header_content"))
    {
        @RenderSection("header_content")
    }
</head>

<body>
    <script type="text/javascript">
        var _relpath = "@(Url.Content("~/favicon.ico").Replace("favicon.ico", ""))";   //relativní cesta: detekce kvůli případnému IIS virtuálnímu adresáři
    </script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/splitter/jquery-resizable.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <script src="~/lib/datepicker/bootstrap-datepicker.min.js"></script>
    @switch (_f.CurrentUser.j02LangIndex)
    {
        case 0:
            <script src="~/lib/datepicker/bootstrap-datepicker.cs.min.js"></script>
            break;
        case 2:
            <script src="~/lib/datepicker/bootstrap-datepicker.ua.min.js"></script>
            break;
        case 4:
            <script src="~/lib/datepicker/bootstrap-datepicker.cs.min.js"></script>
            break;
        default:
            break;
    }
    <script src="~/lib/qtip/jquery.qtip.min.js"></script>
    <script src="~/lib/autocomplete/jquery.autocomplete.min.js"></script>

    

    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="~/js/mycombo.js" asp-append-version="true"></script>
    <script src="~/js/thegrid.js" asp-append-version="true"></script>
    <script src="~/js/contextmenu.js" asp-append-version="true"></script>
    <script src="~/js/mycontrols.js" asp-append-version="true"></script>
    <script src="~/js/layoutshare.js" asp-append-version="true"></script>

    <script type="text/javascript">
        
        
        @if (Model.Javascript_CallOnLoad != null)
        {
           
            @Html.Raw(Model.Javascript_CallOnLoad)


        }
        
           
        
    </script>


    <div>
        @if (Model.PageTitle != null)
        {
            <h4>
                @if (Model.PageSymbol != null)
                {
                    <myicon symbol="@Model.PageSymbol" perc="150"></myicon>
                }
                @Model.PageTitle

                @if(Model.PageTitleAfter !=null){
                    <code style="margin-left:10px;">
                        @Html.Raw(Model.PageTitleAfter)
                    </code>
                    
                }
            </h4>
        }

        @RenderBody()
        
    </div>



    <script type="text/javascript">
        var _modal;
        var _element2focus = "@Model.Element2Focus";
       

        $(document).ready(function () {

            if (document.getElementById("IsPostback")) {
                $("#IsPostback").val("false");
                $("#PostbackOper").val("");
            }

        @if (_f.CurrentUser.Messages4Notify != null)
        {
            @foreach (var c in _f.CurrentUser.Messages4Notify)
            {  // <----  placed on the same line, WORKING !!!

                @:_notify_message("@Html.Raw(c.Value)", "@c.Key");

            }
        }
           if ($("#toolbar_changeinfo").length) {
                //události na editačních formulářích
                $("form").submit(function () {
                    if ($(document.activeElement).attr("type") == "submit")
                        return true;
                    else return false;
                });

                _resize_textareas()

            }


            $(document).on("click", function (e) {
                if (e.target == _modal) {
                    _window_in_modal_close();
                }
            });
            $(document).on("keydown", function (e) {
                if (e.keyCode == 27 && _modal != null && _modal.style.display == "block") {

                    _window_in_modal_close();

                }
                if (e.keyCode == 13 && e.target.nodeName != "BUTTON" && e.target.nodeName != "TEXTAREA") {                //zabránit submit formuláře po stisknutí ENTER na jakémkoliv non-submit input elementu
                    e.preventDefault();
                    return false;
                }
            });

            if (_element2focus != "" && document.getElementById(_element2focus)) {
                $("#" + _element2focus).focus();

            }

            if (_device.isMobile) {
                _init_elements_for_mobile();
            } else {
                _init_qtip_onpage(document);
            }

            

            
        });



        function _window_close() {

            if (document.getElementById("myModalContainer")) {
                if ($(_modal).css("display") == "block") {  //test, zda o zavření volá modální okno nebo okno otevřené z modálního okna (3.vrstva)
                    _window_in_modal_close();
                    return;
                }
            }

            if (window != top) {

                window.parent._window_close();  //toto okno je uvnitř iframe
            } else {
                window.close();
            }
        }

        function _window_in_modal_close() {
            var iframe = document.getElementById("fraModalContent");
            var elmnt = iframe.contentWindow.document.getElementById("toolbar_changeinfo");
            if ($(elmnt).text() !== "") {
                if (confirm("@_f.tra("Chcete zavřít okno bez uložení změn?")")) {
                    $(_modal).css("display", "none");
                } else {
                    return;
                }
            }
            $(_modal).css("display", "none");
        }

        function _window_open(url, flag, header, layout) {
            if (location.href.indexOf("p31dayline/Zoom") > 0) {
                //otevření okna se ZOOM okna v rámci kalendáře nebo dayline
                window.parent._window_open(url, flag, header, layout);
                return;
            }

            if (typeof header === "undefined") header = "";
            if (document.getElementById("myModalContainer")) {
                //modal div na stránce již existuje
            } else {
                var el = document.createElement("DIV");
                $(el).css("position", "absolute");

                el.id = "myModalContainer";
                document.body.appendChild(el);

                var s = "<div id='myModalContent'>";
                s += "<div style='height:30px;background-color: green;color:white;padding:3px;'>";
                s += "<button class='btn btn-success btn-sm float-left' onclick='_window_in_modal_close()' style='margin-left:3px;margin-right:3px;'>&times;</button>";
                s += "<span>" + header + "</span>";
                s += "<button class='btn btn-success btn-sm float-end' onclick='_window_in_modal_close()' style='margin-right:3px;'>&times;</button>";
                s += "</div>";
                s += "<div id='myModalFrame' style='padding: 0px; margin:0px 0px 0px 10px; overflow: auto; -webkit-overflow-scrolling: touch;'>";
                s += "<iframe id='fraModalContent' name='fraModalContent' frameborder='0'></iframe>";
                s += "</div>";
                s += "</div>";

                _modal = document.getElementById("myModalContainer");
                $(_modal).html(s);
                _make_element_draggable(document.getElementById("myModalContent"), document.getElementById("myModalFrame")); //předávání nefunguje přes jquery
            }


            var okno = $("#myModalContent");
            var fra = $("#fraModalContent");

            var w = window.innerWidth - 40;

            var h = window.innerHeight - 30;
            var x = 0;
            var y = 0;

            $(okno).css("width", w);
            $(okno).css("height", h);
            $(okno).css("left", x);
            $(okno).css("top", y);
            $(fra).css("width", w - 15);
            $(fra).css("height", h - 30 - 10);    //10 padding dole, 30 div header

            if (url !== "") {

                if (layout == undefined || layout == null)
                {
                    layout="modal";
                }
                if (url.indexOf("?") > 0) {
                    url = url + "&layout=" + layout;
                } else {
                    url = url + "?layout=" + layout;
                }

                url = _ep(url);
                $(fra).attr("src", url);
            }


            $(_modal).css("display", "block");
        }

        function _submit() {
            if (!document.getElementById("form1")) {
                alert("Chybí formulář form1!");
                return;
            }
            var element = event.target;
            if (element.tagName == "BUTTON") {
                $(event.target).text("Processing...");
                $(event.target).attr("disabled", true);
            }
            form1.submit();
        }
        function _postback(oper, ocas) {

            if (!document.getElementById("form1")) {
                alert("Chybí formulář form1!");
                return;
            }
            if (!document.getElementById("IsPostback")) {
                $("#form1").append("<input type='hidden' id='IsPostback' name='IsPostback' value='false' />");
                $("#form1").append("<input type='hidden' id='PostbackOper' name='PostbackOper' value='' />");
            }

            if (event) {
                var element = event.target;
                if (element.tagName == "SPAN") {
                    element = element.parentElement;
                }
                if (element.tagName == "MYICON") {
                    element = element.parentElement;
                }
                if (element.tagName == "BUTTON") {
                    $(element).text("Processing...");
                    $(element).attr("disabled", true);
                } else {
                    _loading_show("postback");
                }

            }



            $("#IsPostback").val(true);
            if (typeof oper === "undefined") oper = "";
            if (typeof ocas === "undefined" || ocas == null) ocas = "";
            $("#PostbackOper").val(oper);

            if (ocas != "") {
                form1.action = form1.action + "?" + ocas;
            }

            form1.submit();
        }

    </script>

    @RenderSection("Scripts", required: false)
</body>
</html>
